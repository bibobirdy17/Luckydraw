<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>可愛購物頁面 DEMO</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body class="bg-pink-50">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center text-pink-600 mb-6">比比波波可愛小舖</h1>

    <!-- 商品列表 -->
    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- 商品將由 JS 動態插入 -->
    </div>

    <!-- 購物車表單 -->
    <form id="order-form" class="bg-white p-4 rounded-xl shadow mt-8">
      <h2 class="text-xl font-bold mb-4">結帳資訊</h2>
      <div id="order-summary"></div>
      <div class="mt-4">
        <label class="block">姓名：<input name="name" class="border p-2 w-full" required></label>
        <label class="block mt-2">Email：<input name="email" type="email" class="border p-2 w-full" required></label>
        <label class="block mt-2">匯款金額：<input name="amount" class="border p-2 w-full" required></label>
        <label class="block mt-2">銀行末五碼：<input name="bankcode" class="border p-2 w-full" required></label>
      </div>
      <button type="submit" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded mt-4">送出訂單</button>
    </form>
  </div>

  <script>
    // Google 試算表 CSV 轉 JSON API
    const SHEET_ID = "1_im8HX0bpHQcoFXwwLINBEp7Q0CqYiDDLFh2HcTeVp0";
    const SHEET_NAME = "商品資料";
    const SHEET_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;

    let products = [];

    fetch(SHEET_URL)
      .then(res => res.json())
      .then(data => {
        products = data;
        renderProducts();
      });

    function renderProducts() {
      const container = document.getElementById("product-list");
      products.forEach((item, index) => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded-xl shadow";
        card.innerHTML = `
          <img src="${item.圖片網址}" alt="商品圖片" class="w-full h-48 object-cover rounded">
          <h3 class="text-lg font-bold mt-2">${item.名稱}</h3>
          <p class="text-pink-600">$${item.價格}</p>
          <label class="block mt-2">購買數量：
            <input type="number" name="qty" data-name="${item.名稱}" data-price="${item.價格}" min="0" max="99" value="0" class="border p-1 w-full">
          </label>
        `;
        container.appendChild(card);
      });
    }

    document.getElementById("order-form").addEventListener("submit", async function(e) {
      e.preventDefault();
      const form = e.target;
      const items = Array.from(document.querySelectorAll("input[name='qty']"));
      const order = items
        .filter(i => parseInt(i.value) > 0)
        .map(i => ({ name: i.dataset.name, qty: i.value, price: i.dataset.price }));

      if (order.length === 0) return alert("請至少選購一樣商品！");

      const total = order.reduce((sum, item) => sum + item.qty * item.price, 0);

      const payload = {
        timestamp: new Date().toISOString(),
        name: form.name.value,
        email: form.email.value,
        amount: form.amount.value,
        bankcode: form.bankcode.value,
        total,
        items: order.map(i => `${i.name} x${i.qty}`).join(", ")
      };

      // 寫入試算表（透過 AppScript 或 webhook，這裡先 console.log 示意）
      console.log("送出資料：", payload);
      alert("訂單已送出！\n感謝您的購買～");
      form.reset();
    });
  </script>
</body>
</html>
